{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "62a1306b_5a742533",
        "filename": "libc/Android.bp",
        "patchSetId": 1
      },
      "lineNbr": 2296,
      "author": {
        "id": 1003224
      },
      "writtenOn": "2022-12-09T19:52:53Z",
      "side": 1,
      "message": "do we actually need two different libraries? can\u0027t we just have one and let the linker gc the unused stuff?",
      "revId": "640da81b9eeaace6161d07c74518c67396ec0fb2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "05edabc4_f4e33aa5",
        "filename": "libc/Android.bp",
        "patchSetId": 1
      },
      "lineNbr": 2296,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2022-12-11T11:26:07Z",
      "side": 1,
      "message": "I guess that\u0027s probably because we have our own version of some libc symbols like malloc, free, errno, etc.",
      "parentUuid": "62a1306b_5a742533",
      "revId": "640da81b9eeaace6161d07c74518c67396ec0fb2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "be94635c_8352fd34",
        "filename": "libc/Android.bp",
        "patchSetId": 1
      },
      "lineNbr": 2296,
      "author": {
        "id": 1882526
      },
      "writtenOn": "2022-12-12T12:04:10Z",
      "side": 1,
      "message": "Note the difference in `visibility`: `vmbase` acts as a common base library for baremetal Rust projects (and tests) intended to run in Android virtual machines while `pvmfw` is one particular project (uses `vmbase` under the hood) that has extra C dependencies due to it being linked with baremetal C libraries.",
      "parentUuid": "05edabc4_f4e33aa5",
      "revId": "640da81b9eeaace6161d07c74518c67396ec0fb2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5e79da73_cfa1324a",
        "filename": "libc/Android.bp",
        "patchSetId": 1
      },
      "lineNbr": 2296,
      "author": {
        "id": 1003224
      },
      "writtenOn": "2022-12-12T16:27:05Z",
      "side": 1,
      "message": "\u003e I guess that\u0027s probably because we have our own version of some libc symbols like malloc, free, errno, etc.\n\nno, i don\u0027t mean _all_ of libc ... i mean \"why libc_baremetal_rust_deps and libc_libpvmfw_deps?\"\n\n\u003e Note the difference in visibility: vmbase acts as a common base library for baremetal Rust projects (and tests) intended to run in Android virtual machines while pvmfw is one particular project (uses vmbase under the hood) that has extra C dependencies due to it being linked with baremetal C libraries.\n\nbut why is that a distinction worth making? it\u0027s extra complexity on this side --- what justifies that on the caller side? i\u0027d rather juat have one baremetal rust library.\n\n(as a nit, \"_deps\" is a weird thing to say in the build system, where \"dependencies\" means something else entirely. just use the more traditional \"librust_baremetal\" instead?)",
      "parentUuid": "be94635c_8352fd34",
      "revId": "640da81b9eeaace6161d07c74518c67396ec0fb2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f36ff21d_a5160ef5",
        "filename": "libc/Android.bp",
        "patchSetId": 1
      },
      "lineNbr": 2296,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2022-12-13T02:53:37Z",
      "side": 1,
      "message": "I am not Pierre, but I felt that he tried to not add \"random stuffs that happen to be needed by pvmfw\" to libc_baremetal_rust_deps which could be used by other baremetal Rust projects.\n\nAnd I agree with you Eliott. _deps is not a good name for these.",
      "parentUuid": "5e79da73_cfa1324a",
      "revId": "640da81b9eeaace6161d07c74518c67396ec0fb2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "72479501_4f18849b",
        "filename": "libc/Android.bp",
        "patchSetId": 1
      },
      "lineNbr": 2296,
      "author": {
        "id": 1882526
      },
      "writtenOn": "2022-12-13T14:18:48Z",
      "side": 1,
      "message": "\u003e why is that a distinction worth making?\n\nBecause `baremetal_rust` is the bare minimum required by any baremetal Rust project (as the compiler assumes that `memcpy`, `memset`, and `memcmp` are valid symbols the linker will resolve) while `libpvmfw` provides the symbols that are expected by the (mostly baremetal) C libraries `pvmfw` links against (`libfdt`, `libavb`, `open-dice`) e.g. `__memcpy_chk` or `strtoul`, which aren\u0027t necessarily needed by Rust projects.\n\n\u003e it\u0027s extra complexity on this side --- what justifies that on the caller side? i\u0027d rather juat have one baremetal rust library.\n\nThat\u0027s understandable but would mean that any libc function added for one Rust project would be used by all Rust projects, with the risk of symbols clashing; see [qwandor\u0027s concern on a related CL](https://android-review.git.corp.google.com/c/platform/packages/modules/Virtualization/+/2338645/comments/b6ea6786_f99619cb).\n\n\u003e just use the more traditional \"librust_baremetal\" instead?\n\nDone (here and in aosp/2337444 and aosp/2338645).",
      "parentUuid": "5e79da73_cfa1324a",
      "revId": "640da81b9eeaace6161d07c74518c67396ec0fb2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3b4b6810_92ea1fa2",
        "filename": "libc/Android.bp",
        "patchSetId": 1
      },
      "lineNbr": 2303,
      "author": {
        "id": 1003224
      },
      "writtenOn": "2022-12-12T16:27:24Z",
      "side": 1,
      "message": "(this isn\u0027t needed any more.)",
      "revId": "640da81b9eeaace6161d07c74518c67396ec0fb2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "53956d3f_3eec562d",
        "filename": "libc/Android.bp",
        "patchSetId": 1
      },
      "lineNbr": 2303,
      "author": {
        "id": 1882526
      },
      "writtenOn": "2022-12-13T14:18:48Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "3b4b6810_92ea1fa2",
      "revId": "640da81b9eeaace6161d07c74518c67396ec0fb2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}