{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "ec232eeb_c8284ca3",
        "filename": "cpu_target_features/Android.bp",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1096946
      },
      "writtenOn": "2024-08-16T17:07:32Z",
      "side": 1,
      "message": "this file seems to be missing a genrule?",
      "revId": "6c0b838ecf6e2109a71d71254b5637fefa87c48d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1773a52b_1fb0e741",
        "filename": "cpu_target_features/Android.bp",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1873222
      },
      "writtenOn": "2024-08-16T19:31:39Z",
      "side": 1,
      "message": "This was intentional. I\u0027ll just requote my last comment:\n\n\u003e First pass at this, without the build rule simply because I wanted to get this out there and get reviews on the generation script and the selected defines.\n\u003e \n\u003e This does not install on the device yet. Haven\u0027t quite gotten that to work, or figured out how to do it like it was inside system/core.\n\nI see though that this can\u0027t be merged without the source files themselves, as it fails the presubmit anyways... I guess I\u0027ll try to figure something out.",
      "parentUuid": "ec232eeb_c8284ca3",
      "revId": "6c0b838ecf6e2109a71d71254b5637fefa87c48d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "13142f36_70237399",
        "filename": "cpu_target_features/Android.bp",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1003224
      },
      "writtenOn": "2024-08-16T19:46:00Z",
      "side": 1,
      "message": "\u003e This does not install on the device yet. Haven\u0027t quite gotten that to work, or figured out how to do it like it was inside system/core.\n\noh, to be clear: i meant literally \"we\u0027ll just add this binary\u0027s name to the list in system/core/\". if you look, ldd is in bionic, but gets onto the device via that list in system/core/...\n\n\u003e I see though that this can\u0027t be merged without the source files themselves, as it fails the presubmit anyways... I guess I\u0027ll try to figure something out.\n\nyeah, may as well just go straight to writing the genrule. let me know if you feel like you\u0027re stuck/going round in circles though, and i\u0027ll try to help. (and if _i_ get stuck, i\u0027ll just ask ccross :-) )",
      "parentUuid": "1773a52b_1fb0e741",
      "revId": "6c0b838ecf6e2109a71d71254b5637fefa87c48d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b55bf099_8788fae6",
        "filename": "cpu_target_features/Android.bp",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1873222
      },
      "writtenOn": "2024-08-16T23:22:16Z",
      "side": 1,
      "message": "Alright, I think I finally have a working example. Fundamentally, the things I was getting hung up on were:\n\n1. There can only be one output file for each genrule.\n2. Dependency tracking is done through `:\u003coutput file\u003e`\n3. You can\u0027t nest output files.\n4. You can\u0027t list header files in srcs, even when generated.\n\nBut what I have now seems to work? No idea if it\u0027s best practices, so feel free to critique.",
      "parentUuid": "13142f36_70237399",
      "revId": "6c0b838ecf6e2109a71d71254b5637fefa87c48d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5f93eee3_deca4f08",
        "filename": "cpu_target_features/Android.bp",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1003224
      },
      "writtenOn": "2024-08-19T12:45:00Z",
      "side": 1,
      "message": "yeah, that\u0027s why i showed the one-true-awk example, because it includes the header file weirdness.\n\npersonally, for something simple like this, i\u0027d just skip that ... there\u0027s nothing of value/that changes in the header anyway. (in fact, there isn\u0027t really any reason to have different names for the different architectures\u0027 functions, though that does bring up the question of \"what do we do with systems that have mixed 32-bite/64-bit userspaces?\". personally i\u0027d be tempted to say \"it\u0027s 2024, that\u0027s increasingly disallowed, so who cares? primary arch only.\")",
      "parentUuid": "b55bf099_8788fae6",
      "revId": "6c0b838ecf6e2109a71d71254b5637fefa87c48d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f9566531_8cee9092",
        "filename": "cpu_target_features/Android.bp",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1873222
      },
      "writtenOn": "2024-08-19T21:12:22Z",
      "side": 1,
      "message": "I had considered using just one function with different definitions, but I wasn\u0027t a huge fan of the formatting as it could be unclear which arch section it was in at any point in time (and neither Vim or VSCode made any distinction either). At compile time these are removed via DCE anyways, so I thought \"eh, good enough. More maintainable.\"\n\nIf this is important to you, I could go back to that (since it\u0027s now autogenerated, who cares). But otherwise I\u0027m going to keep it as is.",
      "parentUuid": "5f93eee3_deca4f08",
      "revId": "6c0b838ecf6e2109a71d71254b5637fefa87c48d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "01c33e9a_c80721c3",
        "filename": "cpu_target_features/Android.bp",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1003224
      },
      "writtenOn": "2024-08-29T13:57:46Z",
      "side": 1,
      "message": "you can literally delete most of this change if you don\u0027t have separate names though, right? (and it\u0027s not like libc folks don\u0027t already have to deal with \"which memset() exactly?\" :-) and here the whole point is that no-one should ever have to look at anything but the `_FEATURES` in the .py file...)\n\notherwise lgtm. (and thanks for adding a riscv64 example!)",
      "parentUuid": "f9566531_8cee9092",
      "revId": "6c0b838ecf6e2109a71d71254b5637fefa87c48d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "2538c90a_3306f0d0",
        "filename": "cpu_target_features/Android.bp",
        "patchSetId": 3
      },
      "lineNbr": 12,
      "author": {
        "id": 1096946
      },
      "writtenOn": "2024-08-16T17:07:32Z",
      "side": 1,
      "message": "(i\u0027m kind of surprised there\u0027s no global defaults or similar that these get pulled from)",
      "range": {
        "startLine": 8,
        "startChar": 0,
        "endLine": 12,
        "endChar": 0
      },
      "revId": "6c0b838ecf6e2109a71d71254b5637fefa87c48d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "11a6be16_10a62be6",
        "filename": "cpu_target_features/Android.bp",
        "patchSetId": 3
      },
      "lineNbr": 12,
      "author": {
        "id": 1873222
      },
      "writtenOn": "2024-08-16T19:31:39Z",
      "side": 1,
      "message": "There may be, but these were present in system/core, so I thought better safe than sorry.",
      "parentUuid": "2538c90a_3306f0d0",
      "range": {
        "startLine": 8,
        "startChar": 0,
        "endLine": 12,
        "endChar": 0
      },
      "revId": "6c0b838ecf6e2109a71d71254b5637fefa87c48d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "65e69d73_94892e84",
        "filename": "cpu_target_features/Android.bp",
        "patchSetId": 3
      },
      "lineNbr": 12,
      "author": {
        "id": 1003224
      },
      "writtenOn": "2024-08-16T19:46:00Z",
      "side": 1,
      "message": "yeah, this stuff is in https://source.corp.google.com/h/android/platform/superproject/main/+/main:build/soong/cc/config/global.go;l\u003d37?q\u003dfile:build%2Fsoong%20Wall%20case:yes\u0026sq\u003drepo:android%2Fplatform%2Fsuperproject%2Fmain%20b:main%20-file:prebuilts%2Fvndk%2F%20-file:prebuilts%2Fruntime%2F\n\nbut there\u0027s a _lot_ of copy and paste around the tree. we should clean that up one day...\n\ni\u0027m not sure where in system/core/ you found the -fno-exceptions though, or the -Oz?\n\n(but, yeah, i\u0027d just delete all this.)",
      "parentUuid": "11a6be16_10a62be6",
      "range": {
        "startLine": 8,
        "startChar": 0,
        "endLine": 12,
        "endChar": 0
      },
      "revId": "6c0b838ecf6e2109a71d71254b5637fefa87c48d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ef007a60_8e4e6f44",
        "filename": "cpu_target_features/Android.bp",
        "patchSetId": 3
      },
      "lineNbr": 12,
      "author": {
        "id": 1873222
      },
      "writtenOn": "2024-08-16T23:22:16Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "65e69d73_94892e84",
      "range": {
        "startLine": 8,
        "startChar": 0,
        "endLine": 12,
        "endChar": 0
      },
      "revId": "6c0b838ecf6e2109a71d71254b5637fefa87c48d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1b920052_324f8550",
        "filename": "cpu_target_features/Android.bp",
        "patchSetId": 3
      },
      "lineNbr": 22,
      "author": {
        "id": 1003224
      },
      "writtenOn": "2024-08-16T19:46:00Z",
      "side": 1,
      "message": "one slightly subtle part of the genrule thing is you\u0027ll need a `:` name for this once it\u0027s generated. the one-true-awk example i gave you is a good place to start, and also shows you how the header file stuff works (since you mentioned a header).\n```\ncc_defaults {\n    name: \"awk-defaults\",\n    defaults: [\"awk-flags\"],\n    generated_headers: [\"awkgram.tab.h\"],\n    srcs: [\n        \"b.c\",\n        \"lex.c\",\n        \"lib.c\",\n        \"main.c\",\n        \"parse.c\",\n        \":proctab.c\",\n        \"run.c\",\n        \"tran.c\",\n        \":awkgram.tab.c\",\n    ],\n}\n```",
      "revId": "6c0b838ecf6e2109a71d71254b5637fefa87c48d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d5560a73_485c01ef",
        "filename": "cpu_target_features/Android.bp",
        "patchSetId": 3
      },
      "lineNbr": 22,
      "author": {
        "id": 1873222
      },
      "writtenOn": "2024-08-16T23:22:16Z",
      "side": 1,
      "message": "Thanks for the tip! This was very useful in trying to debug what I was doing wrong with genrule.",
      "parentUuid": "1b920052_324f8550",
      "revId": "6c0b838ecf6e2109a71d71254b5637fefa87c48d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}