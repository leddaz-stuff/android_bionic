{
  "comments": [
    {
      "key": {
        "uuid": "57975702_deaea5ff",
        "filename": "libc/bionic/pthread_once.cpp",
        "patchSetId": 5
      },
      "lineNbr": 54,
      "author": {
        "id": 1003224
      },
      "writtenOn": "2015-01-28T04:25:11Z",
      "side": 1,
      "message": "move L49-54 inside the loop and remove L83?",
      "revId": "80e6d6d825df4616808b22b5639114566c27af0e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "17a15f5e_1c5ad5eb",
        "filename": "libc/bionic/pthread_once.cpp",
        "patchSetId": 5
      },
      "lineNbr": 54,
      "author": {
        "id": 1056364
      },
      "writtenOn": "2015-01-28T04:55:31Z",
      "side": 1,
      "message": "As far as I can see, if we move L49-54 inside the loop, we will have to reread the value when atomic_compare_exchange_weak_explicit fails, which is a duplication. The change may make cleaner code, but may not be better in showing the logic of the code. So I prefer current version.",
      "parentUuid": "57975702_deaea5ff",
      "revId": "80e6d6d825df4616808b22b5639114566c27af0e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "17a15f5e_7ce3d9a9",
        "filename": "libc/bionic/pthread_once.cpp",
        "patchSetId": 5
      },
      "lineNbr": 54,
      "author": {
        "id": 1003224
      },
      "writtenOn": "2015-01-28T05:19:02Z",
      "side": 1,
      "message": "don\u0027t we _want_ to re-read in the case where the cas fails? we know we only try the cas if the state\u0027s not COMPLETE, and we know it failed so it\u0027s changed since we first read. so won\u0027t we just spin now?",
      "parentUuid": "17a15f5e_1c5ad5eb",
      "revId": "80e6d6d825df4616808b22b5639114566c27af0e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3794a3fe_bdd15fd2",
        "filename": "libc/bionic/pthread_once.cpp",
        "patchSetId": 5
      },
      "lineNbr": 54,
      "author": {
        "id": 1056364
      },
      "writtenOn": "2015-01-28T06:35:19Z",
      "side": 1,
      "message": "According to http://en.cppreference.com/w/c/atomic/atomic_compare_exchange, if atomic_compare_exchange_weak_explicit fails, the actually value will be loaded into old_value, so we may not need another read for it.",
      "parentUuid": "17a15f5e_7ce3d9a9",
      "revId": "80e6d6d825df4616808b22b5639114566c27af0e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}