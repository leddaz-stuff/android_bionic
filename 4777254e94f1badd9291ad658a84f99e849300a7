{
  "comments": [
    {
      "key": {
        "uuid": "4328e79f_e5648160",
        "filename": "libc/malloc_debug/AndroidTest.xml",
        "patchSetId": 1
      },
      "lineNbr": 19,
      "author": {
        "id": 1002751
      },
      "writtenOn": "2017-03-31T17:56:19Z",
      "side": 1,
      "message": "It seems unfortunate to hardcode this location in every single test description.  Can we just tell the test runner that we want the file pushed to a temporary directory and run from there?\n\nThat would also let the test runner provide better isolation by creating a new temp directory per test and cleaning it up",
      "range": {
        "startLine": 19,
        "startChar": 60,
        "endLine": 19,
        "endChar": 76
      },
      "revId": "4777254e94f1badd9291ad658a84f99e849300a7",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "854a2700_ee26f330",
        "filename": "libc/malloc_debug/AndroidTest.xml",
        "patchSetId": 1
      },
      "lineNbr": 19,
      "author": {
        "id": 1088076
      },
      "writtenOn": "2017-03-31T18:01:23Z",
      "side": 1,
      "message": "malloc_debug_unit_tests here is a folder name, not the binary name. So the binary will be pushed to the device at:\n/data/local/tmp/malloc_debug_unit_tests/malloc_debug_unit_tests\n\nThus each binary is running in its own folder. I think the name is kept in the path to make sure less chance of collision.\n\nI don\u0027t think the PushFilePreparer is that smart to pick a tmp dir automatically. Also, the binary should be located in a folder for GTest to be able to run the binary (through option native-test-device-path in line 23)",
      "parentUuid": "4328e79f_e5648160",
      "range": {
        "startLine": 19,
        "startChar": 60,
        "endLine": 19,
        "endChar": 76
      },
      "revId": "4777254e94f1badd9291ad658a84f99e849300a7",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "bcce4f42_a7806dca",
        "filename": "libc/malloc_debug/AndroidTest.xml",
        "patchSetId": 1
      },
      "lineNbr": 19,
      "author": {
        "id": 1002751
      },
      "writtenOn": "2017-03-31T19:35:04Z",
      "side": 1,
      "message": "At least supporting $TMP or $TESTDIR or something would help.\n\nIf PushFilePreparer is specifying a directory, why does GTest get /data/local/tmp?  Is it assuming that every config is going push the test into the file \u003cnative-test-device-path\u003e/\u003ctest_name\u003e/\u003ctest_name\u003e?  That seems error prone.",
      "parentUuid": "854a2700_ee26f330",
      "range": {
        "startLine": 19,
        "startChar": 60,
        "endLine": 19,
        "endChar": 76
      },
      "revId": "4777254e94f1badd9291ad658a84f99e849300a7",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "dd51bae1_8adf1e95",
        "filename": "libc/malloc_debug/AndroidTest.xml",
        "patchSetId": 1
      },
      "lineNbr": 19,
      "author": {
        "id": 1003224
      },
      "writtenOn": "2017-03-31T21:07:22Z",
      "side": 1,
      "message": "i haven\u0027t understood why we\u0027re shitting these XML files all over the tree at all... seems like no-one really thought this through.",
      "parentUuid": "bcce4f42_a7806dca",
      "range": {
        "startLine": 19,
        "startChar": 60,
        "endLine": 19,
        "endChar": 76
      },
      "revId": "4777254e94f1badd9291ad658a84f99e849300a7",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "328df5b6_b7f285b8",
        "filename": "libc/malloc_debug/AndroidTest.xml",
        "patchSetId": 1
      },
      "lineNbr": 19,
      "author": {
        "id": 1088076
      },
      "writtenOn": "2017-03-31T21:42:48Z",
      "side": 1,
      "message": "yeah, something like generic $TMP could be handy. Related change is needed in GTest to look for modules in $TMP though. \n\nPushFilePreparer is generic, the option push takes in a module and direct (-\u003e) it to a target dir, which has no knowledge of if the test is a native test.",
      "parentUuid": "bcce4f42_a7806dca",
      "range": {
        "startLine": 19,
        "startChar": 60,
        "endLine": 19,
        "endChar": 76
      },
      "revId": "4777254e94f1badd9291ad658a84f99e849300a7",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "26b6ad0b_a774c4ae",
        "filename": "libc/malloc_debug/AndroidTest.xml",
        "patchSetId": 1
      },
      "lineNbr": 19,
      "author": {
        "id": 1088076
      },
      "writtenOn": "2017-03-31T21:42:48Z",
      "side": 1,
      "message": "+sbasi\n\nThe details of these changes are described in the design doc:\nhttps://docs.google.com/document/d/1eabK3srlBLouMiBMrNP3xJPiRRdcoCquNxC8gBWPvx8/edit\n\nThe goal is basically to move test configuration closer to the test itself, so\n1. developers can run tradefed command line to run the test, same as in the test lab.\n2. one can add/remove a test to/from a suite in the project containing the test. For example, a test becomes unstable and needs some fix, the developer fixing the test can remove the test from apct suite in the same project, without the need to create a CL in tradefed.\n3. having test config next to the test makes it more obvious that a test is running in desired suites in the lab.",
      "parentUuid": "dd51bae1_8adf1e95",
      "range": {
        "startLine": 19,
        "startChar": 60,
        "endLine": 19,
        "endChar": 76
      },
      "revId": "4777254e94f1badd9291ad658a84f99e849300a7",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7f047de2_52afef2f",
        "filename": "libc/malloc_debug/AndroidTest.xml",
        "patchSetId": 1
      },
      "lineNbr": 19,
      "author": {
        "id": 1002751
      },
      "writtenOn": "2017-03-31T22:38:10Z",
      "side": 1,
      "message": "I agree that test config should go near the test, but I think this config is at the wrong level.  As a test developer, I should just be able to say \"this is a gtest\", and maybe \"I also need these files\".  Everything else is an implementation detail of the test runner, and shouldn\u0027t be duplicated in every test config.  At the _very_ least, I think this file should look something like:\n\n  \u003cconfiguration description\u003d\"Config for malloc_debug_unit_tests\"\u003e\n      \u003ctarget_preparer class\u003d\"com.android.tradefed.targetprep.GtestPreparer\"\u003e\n          \u003coption name\u003d\"module-name\" value\u003d\"malloc_debug_unit_tests\" /\u003e\n      \u003c/target_preparer\u003e\n      \u003coption name\u003d\"test-suite-tag\" value\u003d\"apct\" /\u003e\n      \u003ctest class\u003d\"com.android.tradefed.testtype.GTest\" \u003e\n          \u003coption name\u003d\"module-name\" value\u003d\"malloc_debug_unit_tests\" /\u003e\n      \u003c/test\u003e\n  \u003c/configuration\u003e\n\nEven better would be not having to separately specify the preparer and the runner.\n\nEven betterer would be not having to specify this file at all, and just have the build system generate it - it should already know the name of the module, that the module is a gtest, and the test suites it belongs to.  Maybe generate it if test_suites is set but test_config is not set, and use a file specified by test_config if it is set?",
      "parentUuid": "26b6ad0b_a774c4ae",
      "range": {
        "startLine": 19,
        "startChar": 60,
        "endLine": 19,
        "endChar": 76
      },
      "revId": "4777254e94f1badd9291ad658a84f99e849300a7",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "050b4990_07a41799",
        "filename": "libc/malloc_debug/AndroidTest.xml",
        "patchSetId": 1
      },
      "lineNbr": 19,
      "author": {
        "id": 1088076
      },
      "writtenOn": "2017-04-01T00:41:18Z",
      "side": 1,
      "message": "Filed b/36818939 to track the test config issue. I think that\u0027s a good idea.\n\nFor the build system to generate it, I think it makes sense for gtest, not sure what needs to be done though. Also, the builder shouldn\u0027t try to overwrite existing test config files, as that could be updated with more user options.\n\nI need to abandon this CL as one pointed out that I should put internal doc link in this cl.",
      "parentUuid": "7f047de2_52afef2f",
      "range": {
        "startLine": 19,
        "startChar": 60,
        "endLine": 19,
        "endChar": 76
      },
      "revId": "4777254e94f1badd9291ad658a84f99e849300a7",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "dccc5dcd_cc5be9dd",
        "filename": "libc/malloc_debug/AndroidTest.xml",
        "patchSetId": 1
      },
      "lineNbr": 19,
      "author": {
        "id": 1003224
      },
      "writtenOn": "2017-04-01T00:45:31Z",
      "side": 1,
      "message": "if you check your documentation into the tree as a .md file, you can conveniently link to it and everyone -- including external AOSP contributors at partner companies -- can read it.",
      "parentUuid": "050b4990_07a41799",
      "range": {
        "startLine": 19,
        "startChar": 60,
        "endLine": 19,
        "endChar": 76
      },
      "revId": "4777254e94f1badd9291ad658a84f99e849300a7",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}