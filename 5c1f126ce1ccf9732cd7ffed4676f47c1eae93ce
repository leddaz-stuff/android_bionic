{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "ca224b21_4e76e398",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1726181
      },
      "writtenOn": "2021-04-15T14:28:26Z",
      "side": 1,
      "message": "Note that the Android.bp file already does a similar thing for libc_dns, libc_openbsd_ndk, libc_openbsd_large_stack, libc_openbsd, libc_gdtoa, crtbrand, crtend_so and crtend_android. \n\nSo I\u0027m not sure why this change wasn\u0027t already done for all modules that depended on private includes.\n\ncc-ing Dan and Colin",
      "revId": "5c1f126ce1ccf9732cd7ffed4676f47c1eae93ce",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2fc24d24_f7f39464",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1687194
      },
      "writtenOn": "2021-04-15T14:29:46Z",
      "side": 1,
      "message": "I believe the error is in our conversion to Bazel, I\u0027m tracking it http://b/185119636.",
      "parentUuid": "ca224b21_4e76e398",
      "revId": "5c1f126ce1ccf9732cd7ffed4676f47c1eae93ce",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3ac93517_f83acdbf",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1726181
      },
      "writtenOn": "2021-04-15T14:37:08Z",
      "side": 1,
      "message": "Most of the existing \u0027private\u0027 includes were added (e.g. by Dan and Elliott) prior to our Bazel adventures though? I\u0027m just not sure why they weren\u0027t added consistently. \n\nHappy to solve this another way though, my main goal was just to unblock more cc_library_static targets (https://android-review.googlesource.com/c/platform/build/soong/+/1677125)",
      "parentUuid": "2fc24d24_f7f39464",
      "revId": "5c1f126ce1ccf9732cd7ffed4676f47c1eae93ce",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "57f0fba5_b165f002",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1687194
      },
      "writtenOn": "2021-04-15T14:38:44Z",
      "side": 1,
      "message": "https://r.android.com/1673685, but bazel build //bionic/...  fails due to the issue we discussed yesterday, where there is an Android.bp file but no BUILD file.",
      "parentUuid": "3ac93517_f83acdbf",
      "revId": "5c1f126ce1ccf9732cd7ffed4676f47c1eae93ce",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "784e78e8_1de25bd2",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1726181
      },
      "writtenOn": "2021-04-15T15:02:07Z",
      "side": 1,
      "message": "Ahh maybe I\u0027ll work on getting more BUILD files generated tomorrow then?\n\nFor this CL though - if the argument is that this isn\u0027t a scalable approach, well, in this case I have already done it :-) So I would be in favor of submitting this, and then considering alternate approaches if we run into this problem again?",
      "parentUuid": "57f0fba5_b165f002",
      "revId": "5c1f126ce1ccf9732cd7ffed4676f47c1eae93ce",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "657b9069_6d8d9f4a",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1605027
      },
      "writtenOn": "2021-04-15T17:49:05Z",
      "side": 1,
      "message": "I don\u0027t understand how adding `private` to local_include_dirs is correct for these modules -- so I\u0027m more than a little confused how this fixes builds for these targets.\n\nLets take bionic/fortify.cpp. It depends on \"private/bionic_fortify.h\", so its include directory should globally be \"bionic/libc\", thus a \".\" relative local include directory, *not* `private`.\n\nWhat am I missing?",
      "revId": "5c1f126ce1ccf9732cd7ffed4676f47c1eae93ce",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c7d4b4c8_4472f686",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1726181
      },
      "writtenOn": "2021-04-15T18:01:34Z",
      "side": 1,
      "message": "Currently, bp2build uses the Soong include_dirs, local_include_dirs, etc for two purposes:\n\n1) it translates these to corresponding Bazel includes\n\n2) it lists any headers found in these directories as explicit Bazel srcs\n\nIn particular, the libc_fortify BUILD target ends up with private/*.h files as srcs, which resolves a Bazel compile error\n\nDo you think we should take a different approach?",
      "parentUuid": "657b9069_6d8d9f4a",
      "revId": "5c1f126ce1ccf9732cd7ffed4676f47c1eae93ce",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1f7efceb_bc2d840f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1605027
      },
      "writtenOn": "2021-04-15T18:09:34Z",
      "side": 1,
      "message": "\u003e Do you think we should take a different approach?\n\nYes, because local_include_dirs adds an include path to the options for these modules which is not used. We\u0027re essentially adding incorrect (superfluous at best, buggy at worst) properties to these modules to serve as metadata to bp2build. bp2build should handle hdr globbing correctly with the correctly defined module properties.\n\n\nI\u0027d consider dealing with hdr globbing as I suggest in go/roboleaf-cc-headers, namely:\n\n1. bp2build derives the appropriate include paths based on include_dirs, local_include_dirs, etc\n2. bp2build derives the appropriate hdr globs based on the result of (1).\n\nAs a corolllary, if you\u0027re able to build a bazel target by turning off sandboxing via `--spawn_strategy\u003dstandalone`, that\u0027s indication that the include paths (1) are correct. If, with sandboxing on, the build fails due to missing headers, that\u0027s indication that (2) was implemented incorrectly.",
      "parentUuid": "c7d4b4c8_4472f686",
      "revId": "5c1f126ce1ccf9732cd7ffed4676f47c1eae93ce",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2dd1dc47_6729fcf8",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1726181
      },
      "writtenOn": "2021-04-15T18:25:07Z",
      "side": 1,
      "message": "Given the original bionic/libc/Android.bp\n\ncc_library_static {\n    name: \"libc_fortify\",\n    srcs: [\"bionic/fortify.cpp\"],   # secretly depends on private/...\n    ...\n}\n\nHow is bp2build supposed to know that bionic/libc/private/* should be Bazel srcs? \n\nAre you suggesting that we make every header under the bionic/libc/ subtree available as Bazel srcs?",
      "parentUuid": "1f7efceb_bc2d840f",
      "revId": "5c1f126ce1ccf9732cd7ffed4676f47c1eae93ce",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "165ba917_b4f910e4",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1605027
      },
      "writtenOn": "2021-04-15T18:33:21Z",
      "side": 1,
      "message": "\u003e How is bp2build supposed to know that bionic/libc/private/* should be Bazel srcs? \n\n\".\" is an implicit include directory of libc_fortify, because `include_build_directory: false` is not set on the module. That means any header under bionic/libc can be included, provided it is using a path relative to bionic/libc.\n\n\u003e Are you suggesting that we make every header under the bionic/libc/ subtree available as Bazel srcs?\n\nYes.",
      "parentUuid": "2dd1dc47_6729fcf8",
      "revId": "5c1f126ce1ccf9732cd7ffed4676f47c1eae93ce",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "af632995_26d0bec5",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1726181
      },
      "writtenOn": "2021-04-15T18:45:33Z",
      "side": 1,
      "message": "Right, so bp2build already handles the implicit \u0027.\u0027, but it doesn\u0027t search recursively\n\nhttps://cs.android.com/android/platform/superproject/+/master:build/soong/cc/library.go;l\u003d2178\n\nhttps://cs.android.com/android/platform/superproject/+/master:build/soong/cc/bp2build.go;l\u003d165\n\nhttps://cs.android.com/android/platform/superproject/+/master:build/soong/bazel/properties.go;l\u003d53\n\nWe can change that to be recursive and see if anything else breaks",
      "parentUuid": "165ba917_b4f910e4",
      "revId": "5c1f126ce1ccf9732cd7ffed4676f47c1eae93ce",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "92f8cc24_8f198ebb",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1687194
      },
      "writtenOn": "2021-04-15T18:52:37Z",
      "side": 1,
      "message": "That\u0027s what I proposed in http://b/185119636 and implemented in https://r.android.com/1673685 -- as stated above, it fails in cases where there is an Android.bp but no BUILD file.",
      "parentUuid": "af632995_26d0bec5",
      "revId": "5c1f126ce1ccf9732cd7ffed4676f47c1eae93ce",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}