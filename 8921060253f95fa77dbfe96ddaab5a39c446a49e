{
  "comments": [
    {
      "key": {
        "uuid": "OI35UKCI",
        "filename": "libc/bionic/dlmalloc.c",
        "patchSetId": 4
      },
      "lineNbr": 111,
      "author": {
        "id": 1000413
      },
      "writtenOn": "2013-01-14T19:30:35Z",
      "side": 1,
      "message": "sorry for the late response, but this seems suboptimal to always open a new file every time. Doing the region create every time could make malloc performance unpredictable. Is it possible to do multiple allocations with the same ashmem region? If so, it would be good to only open it once and then reuse the fd.",
      "revId": "8921060253f95fa77dbfe96ddaab5a39c446a49e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "OI6GBNVw",
        "filename": "libc/bionic/dlmalloc.c",
        "patchSetId": 4
      },
      "lineNbr": 111,
      "author": {
        "id": 1010118
      },
      "writtenOn": "2013-01-14T19:55:54Z",
      "side": 1,
      "message": "Not sure I follow your comments Dima. The named_anonymous_mmap is only called either for large mallocs (\u003e256kb) which should be rare and therefore not performance critical, or for when the heap is fragmented and morecore (brk) allocations fail (\"[heap]\" in /proc/pid/maps). The allocations for the fragmented case will be recycled by dlmalloc\u0027s free lists and so we\u0027d only be doing a large number of allocations/ashmem creates if we were leaking memory.",
      "parentUuid": "OI35UKCI",
      "revId": "8921060253f95fa77dbfe96ddaab5a39c446a49e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "OIwG8obk",
        "filename": "libc/bionic/dlmalloc.c",
        "patchSetId": 4
      },
      "lineNbr": 111,
      "author": {
        "id": 1000413
      },
      "writtenOn": "2013-01-14T20:55:33Z",
      "side": 1,
      "message": "That\u0027s fair, your point is well taken that the performance impact would likely be minimal (would love to see the distribution of allocations in malloc across the framework and apps, though).\n\nI\u0027m just generally conscious of doing extra work unnecessarily. We could easily save the fd and reuse it on subsequent calls. Are there any downsides to doing that? Do you want to have the allocations to be \"separate regions\" purpose? Won\u0027t ashmem just name multiple allocations after the region name anyway (don\u0027t remember)?",
      "parentUuid": "OI6GBNVw",
      "revId": "8921060253f95fa77dbfe96ddaab5a39c446a49e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}