{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "0937391c_65918e5b",
        "filename": "libc/include/netdb.h",
        "patchSetId": 5
      },
      "lineNbr": 82,
      "author": {
        "id": 1003224
      },
      "writtenOn": "2023-05-19T17:26:19Z",
      "side": 1,
      "message": "i don\u0027t think this is \"complicated\" (which we\u0027ve been using to mean \"read the docs; there\u0027s a special case here\") ... i think just \"unspecified\" makes sense? (although arguably it\u0027s a completely new thing which is \"we do know what this is [and in this case, that\u0027s `_Nullable`] but clang doesn\u0027t understand common patterns for making use of this safe, so it would be a bad idea for us to actually specify this\" :-( )\n\n+danalbert for thoughts, including whether we should have a new __BIONIC_ macro to explain this (though i\u0027m struggling to think of a name). currently we don\u0027t have any direct use of unspecified, just the \"complicated\" macro.\n\n(like i said, this does kind of worry me about annotating struct fields in general. and most of our existing struct field annotations -- though they didn\u0027t cause build problems -- were a bit questionable to start with. so i guess one option is `__BIONIC_POINTER_IN_STRUCT` which doesn\u0027t look like it\u0027s making any claim about anything, but can have a comment in \u003csys/cdefs.h\u003e explaining why we\u0027re opting out of annotating these for now.)",
      "range": {
        "startLine": 82,
        "startChar": 8,
        "endLine": 82,
        "endChar": 37
      },
      "revId": "507778fc93b1fd2e22762b1d2d9453969b928180",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e89e5a8b_e4d7f72b",
        "filename": "libc/include/netdb.h",
        "patchSetId": 5
      },
      "lineNbr": 82,
      "author": {
        "id": 1890456
      },
      "writtenOn": "2023-05-19T18:18:08Z",
      "side": 1,
      "message": "I see! So this is still `_Nullable_unspecific` BUT with a different macro name, which can help explain why it is unspecific clearly right?",
      "parentUuid": "0937391c_65918e5b",
      "range": {
        "startLine": 82,
        "startChar": 8,
        "endLine": 82,
        "endChar": 37
      },
      "revId": "507778fc93b1fd2e22762b1d2d9453969b928180",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7f547179_19606f22",
        "filename": "libc/include/netdb.h",
        "patchSetId": 5
      },
      "lineNbr": 82,
      "author": {
        "id": 1003224
      },
      "writtenOn": "2023-05-19T18:36:38Z",
      "side": 1,
      "message": "yeah, exactly.\n\n(the biggest question is probably \"am i over-reacting to one clang bug?\", and my answer is \"i have no idea\". i don\u0027t know whether that\u0027s representative at all.)\n\ni was interested to learn from your linux-man@ discussion that they\u0027re adding these annotations to the man pages (but not, afaik, to glibc or musl). but they look like they\u0027re just doing the functions, not the structs. (possibly for our earlier \"what does this even mean?\" reason rather than our newer \"because clang doesn\u0027t understand common idioms for using these safely\".)",
      "parentUuid": "e89e5a8b_e4d7f72b",
      "range": {
        "startLine": 82,
        "startChar": 8,
        "endLine": 82,
        "endChar": 37
      },
      "revId": "507778fc93b1fd2e22762b1d2d9453969b928180",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9cf7c3e1_cbd6c0b4",
        "filename": "libc/include/netdb.h",
        "patchSetId": 5
      },
      "lineNbr": 82,
      "author": {
        "id": 1043845
      },
      "writtenOn": "2023-05-19T18:48:49Z",
      "side": 1,
      "message": "unspecified seems fine to me. If you want to name it, maybe just `__BIONIC_NULLNESS_NOT_EXPRESSIBLE_TO_CLANG`? It\u0027s wordy but correct.",
      "parentUuid": "7f547179_19606f22",
      "range": {
        "startLine": 82,
        "startChar": 8,
        "endLine": 82,
        "endChar": 37
      },
      "revId": "507778fc93b1fd2e22762b1d2d9453969b928180",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8634d82f_0ceb087c",
        "filename": "libc/include/netdb.h",
        "patchSetId": 5
      },
      "lineNbr": 82,
      "author": {
        "id": 1058860
      },
      "writtenOn": "2023-05-19T18:57:12Z",
      "side": 1,
      "message": "Irrespective of the naming, please file a bug with why this could be a clang bug.  The error in PS1 h_addr_list was not annotated as _Nonnull and consequently clang complained about this line in DNSProxyListener.cpp:\n\n\u003e inet_ntop(hp-\u003eh_addrtype, hp-\u003eh_addr_list[i], ip_addr, sizeof(ip_addr))\n\nIs it that we need different annotations when implementing the library vs. using it?",
      "parentUuid": "9cf7c3e1_cbd6c0b4",
      "range": {
        "startLine": 82,
        "startChar": 8,
        "endLine": 82,
        "endChar": 37
      },
      "revId": "507778fc93b1fd2e22762b1d2d9453969b928180",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "74535eff_bc31658c",
        "filename": "libc/include/netdb.h",
        "patchSetId": 5
      },
      "lineNbr": 82,
      "author": {
        "id": 1003224
      },
      "writtenOn": "2023-05-19T19:00:53Z",
      "side": 1,
      "message": "no, the bug was about iterating the alias list with a `while (struct-\u003emember !\u003d nullptr)` loop not causing clang to recognize that struct-\u003emember isn\u0027t going to be null in the body... zijunzhao will be along shortly with the specifics.",
      "parentUuid": "8634d82f_0ceb087c",
      "range": {
        "startLine": 82,
        "startChar": 8,
        "endLine": 82,
        "endChar": 37
      },
      "revId": "507778fc93b1fd2e22762b1d2d9453969b928180",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3f9b58e5_de468950",
        "filename": "libc/include/netdb.h",
        "patchSetId": 5
      },
      "lineNbr": 82,
      "author": {
        "id": 1890456
      },
      "writtenOn": "2023-05-22T20:34:21Z",
      "side": 1,
      "message": "@pirama I already file one here: https://github.com/llvm/llvm-project/issues/62724 \nI think the next step is to name it as `__BIONIC_NULLNESS_NOT_EXPRESSIBLE_TO_CLANG`?",
      "parentUuid": "74535eff_bc31658c",
      "range": {
        "startLine": 82,
        "startChar": 8,
        "endLine": 82,
        "endChar": 37
      },
      "revId": "507778fc93b1fd2e22762b1d2d9453969b928180",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6402cdcd_dd612240",
        "filename": "libc/include/netdb.h",
        "patchSetId": 5
      },
      "lineNbr": 82,
      "author": {
        "id": 1003224
      },
      "writtenOn": "2023-05-22T23:10:29Z",
      "side": 1,
      "message": "or, pirama: is there a #pragma we can wrap structs with, to just skip these annotations for structs, rather than adding a bunch of noise _within_ the structs?",
      "parentUuid": "3f9b58e5_de468950",
      "range": {
        "startLine": 82,
        "startChar": 8,
        "endLine": 82,
        "endChar": 37
      },
      "revId": "507778fc93b1fd2e22762b1d2d9453969b928180",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3d03e162_b76305f4",
        "filename": "libc/include/netdb.h",
        "patchSetId": 5
      },
      "lineNbr": 82,
      "author": {
        "id": 1003224
      },
      "writtenOn": "2023-05-23T20:41:32Z",
      "side": 1,
      "message": "actually, the \u003csys/shm.h\u003e patch suggests an alternative resolution ... it looks like clang doesn\u0027t insist on nullability annotations on structs in headers #included into a header with nullability annotations. so we could move problematic structs from \u003cfoo.h\u003e into \u003cbits/foo_structs.h\u003e or whatever, and just not use nullability annotations for the structs.",
      "parentUuid": "6402cdcd_dd612240",
      "range": {
        "startLine": 82,
        "startChar": 8,
        "endLine": 82,
        "endChar": 37
      },
      "revId": "507778fc93b1fd2e22762b1d2d9453969b928180",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "12ed4825_edbd8f0a",
        "filename": "libc/include/netdb.h",
        "patchSetId": 5
      },
      "lineNbr": 82,
      "author": {
        "id": 1058860
      },
      "writtenOn": "2023-05-23T23:24:18Z",
      "side": 1,
      "message": "\u003e or, pirama: is there a #pragma we can wrap structs with, to just skip these annotations for structs, rather than adding a bunch of noise within the structs?\n\nIs this the `-Wwarn-nullability-missing` warning-that-gets-turned-to-error?  If so, something like the following should work:\n \n```\n#pragma clang diagnostic push\n#pragma clang diagnostic ignored \"-Wmismatched-tags\"\nstruct...\n#pragma clang diagnostic pop\n```",
      "parentUuid": "3d03e162_b76305f4",
      "range": {
        "startLine": 82,
        "startChar": 8,
        "endLine": 82,
        "endChar": 37
      },
      "revId": "507778fc93b1fd2e22762b1d2d9453969b928180",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}