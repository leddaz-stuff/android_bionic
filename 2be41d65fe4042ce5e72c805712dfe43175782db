{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "aafa9d7f_3e04ffbf",
        "filename": "linker/linker_main.cpp",
        "patchSetId": 1
      },
      "lineNbr": 183,
      "author": {
        "id": 1550939
      },
      "writtenOn": "2024-07-19T18:39:01Z",
      "side": 0,
      "message": "Why is this removed?\n\nAlso, wasn\u0027t the intention to make vdso update atomic (e.g. if something fails then vdso ends in a half-updated state, not good)?",
      "range": {
        "startLine": 183,
        "startChar": 2,
        "endLine": 183,
        "endChar": 26
      },
      "fixSuggestions": [
        {
          "fixId": "3312109b_efd3284b",
          "description": "prompt_to_edit API",
          "replacements": [
            {
              "path": "linker/linker_main.cpp",
              "range": {
                "startLine": 185,
                "startChar": 0,
                "endLine": 185,
                "endChar": 0
              },
              "replacement": "static void add_vdso_if_needed() {\n  if (vdso !\u003d nullptr) {\n    return;\n  }\n\n  add_vdso();\n\n  // If the vdso is not present, we don\u0027t need to do anything.\n  if (vdso \u003d\u003d nullptr) {\n    return;\n  }\n\n  // Add the vdso to the global group.\n  vdso-\u003eset_dt_flags_1(vdso-\u003eget_dt_flags_1() | DF_1_GLOBAL);\n\n  // Add the vdso to all other linked namespaces.\n  for (auto linked_ns : g_default_namespace.get_linked_namespaces()) {\n    linked_ns-\u003eadd_soinfo(vdso);\n    vdso-\u003eadd_secondary_namespace(linked_ns);\n  }\n}\n\n\n"
            },
            {
              "path": "linker/linker_main.cpp",
              "range": {
                "startLine": 415,
                "startChar": 0,
                "endLine": 416,
                "endChar": 0
              },
              "replacement": "  add_vdso_if_needed();\n"
            }
          ]
        }
      ],
      "revId": "2be41d65fe4042ce5e72c805712dfe43175782db",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e218c5a3_908078af",
        "filename": "linker/linker_main.cpp",
        "patchSetId": 1
      },
      "lineNbr": 183,
      "author": {
        "id": 1003224
      },
      "writtenOn": "2024-07-19T18:48:58Z",
      "side": 0,
      "message": "\u003e Why is this removed?\n\nsee the commit message :-)\n\n\u003e Also, wasn\u0027t the intention to make vdso update atomic (e.g. if something fails then vdso ends in a half-updated state, not good)?\n\ni think there\u0027s a bug here, but i don\u0027t think that\u0027s the fix ... i think this call of link_image() [the only bit that can fail] should have its return value checked, and we error out in that case. the previous code _looked_ like it was safe, but i don\u0027t think it was actually doing anything useful.",
      "parentUuid": "aafa9d7f_3e04ffbf",
      "range": {
        "startLine": 183,
        "startChar": 2,
        "endLine": 183,
        "endChar": 26
      },
      "revId": "2be41d65fe4042ce5e72c805712dfe43175782db",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9e280a23_efe05941",
        "filename": "linker/linker_main.cpp",
        "patchSetId": 1
      },
      "lineNbr": 183,
      "author": {
        "id": 1550939
      },
      "writtenOn": "2024-07-19T18:51:27Z",
      "side": 0,
      "message": "\u003e see the commit message :-)\n\nAh, I can\u0027t read.\n\n\u003e the previous code looked like it was safe, but i don\u0027t think it was actually doing anything useful\n\nMakes sense.",
      "parentUuid": "e218c5a3_908078af",
      "range": {
        "startLine": 183,
        "startChar": 2,
        "endLine": 183,
        "endChar": 26
      },
      "revId": "2be41d65fe4042ce5e72c805712dfe43175782db",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e6082d9d_b0690778",
        "filename": "linker/linker_main.cpp",
        "patchSetId": 1
      },
      "lineNbr": 183,
      "author": {
        "id": 1229339
      },
      "writtenOn": "2024-07-19T20:46:27Z",
      "side": 0,
      "message": "prelink_image seems more open to failing than link_image, though in practice, neither should ever fail. We could abort the process in that case, maybe?\n\nI looked for things that could plausibly fail, and the protect_relro call looked interesting. I\u0027m guessing a vdso never has a PT_GNU_RELRO segment, but if it did, the kernel would\u0027ve already applied the appropriate protections? Just guessing, though...",
      "parentUuid": "9e280a23_efe05941",
      "range": {
        "startLine": 183,
        "startChar": 2,
        "endLine": 183,
        "endChar": 26
      },
      "revId": "2be41d65fe4042ce5e72c805712dfe43175782db",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "99d97134_529481fc",
        "filename": "linker/linker_main.cpp",
        "patchSetId": 1
      },
      "lineNbr": 183,
      "author": {
        "id": 1003224
      },
      "writtenOn": "2024-07-19T21:16:50Z",
      "side": 0,
      "message": "yeah, good point. i\u0027ve done both.",
      "parentUuid": "e6082d9d_b0690778",
      "range": {
        "startLine": 183,
        "startChar": 2,
        "endLine": 183,
        "endChar": 26
      },
      "revId": "2be41d65fe4042ce5e72c805712dfe43175782db",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}